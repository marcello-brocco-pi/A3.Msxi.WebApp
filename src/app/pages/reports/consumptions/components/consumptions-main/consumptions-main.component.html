<div >
    <p-accordion value="0">
        <p-accordion-panel value="0">
            <p-accordion-header>{{"Filtri" | translate}}</p-accordion-header>
            <p-accordion-content>
                <div [formGroup]="consumptionFilterForm!">
                    <p-fluid>
                         <div class="flex flex-col md:flex-row gap-6">

                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="consumer">{{'Consumer' | translate}}</label>
                                    <p-select name="azienda" formControlName="consumerControlObj" appendTo="body" [filter]="true" filterBy="name" [showClear]="true"
                                       emptyMessage=" " (onChange)="changeSelConsumer()" [options]="consumerList" dataKey="id" optionLabel="name" class="w-full">
                                       <ng-template #footer>
                                        <div class="p-3" style="text-align: center">
                                            <hr>
                                            @if(!isLoading) {
                                                <p-checkbox inputId="idShowConsumerList" formControlName="isIncludeDeactivatedConsumer" [binary]="true" (onChange)="changeIncludeDeactivatedConsumer()"/>
                                                <label for="idShowConsumerList" class="ml-2"> {{'Includi disattivati' | translate}}</label>
                                            }
                                            @else {
                                                <p-progressbar [style]="{'height': '6px', 'background':'navy'}" color="purple" mode="indeterminate" />
                                            }
                                        </div>
                                        </ng-template>
                                    </p-select>                                                                                                             
                                </div>
                          
                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="azienda">{{'Azienda' | translate}}</label>
                                    <p-select name="azienda" formControlName="companyControlObj" appendTo="body" [filter]="true" filterBy="name" [showClear]="true"
                                       emptyMessage=" " (onChange)="changeSelAzienda()" [options]="companyList" dataKey="id" optionLabel="name" class="w-full">
                                    
                                     <ng-template #footer>
                                        <div class="p-3" style="text-align: center">
                                            <hr>
                                            @if(!isLoading) {
                                                <p-checkbox inputId="idShowCompanyList" formControlName="isIncludeDeactivatedCompany" [binary]="true" (onChange)="changeIncludeDeactivatedCompany()"/>
                                                <label for="idShowCompanyList" class="ml-2"> {{'Includi disattivati' | translate}}</label>
                                            }
                                            @else {
                                                <p-progressbar [style]="{'height': '6px', 'background':'navy'}" color="purple" mode="indeterminate" />
                                            }
                                        </div>
                                        </ng-template>
                                    </p-select>                                                                                                             
                                </div>

                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="categoria">{{'Categoria' | translate}}</label>
                                    <p-select name="categoria" formControlName="categoryControlObj" appendTo="body" [filter]="true" filterBy="name" [showClear]="true"
                                       emptyMessage=" " (onChange)="changeSelCategoria()" [options]="categoryList" dataKey="id" optionLabel="name" class="w-full"></p-select>                                                                                                             
                                </div>

                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="servizi">{{'Servizi' | translate}}</label>
                                    <p-select name="servizi" formControlName="servicesControlObj" appendTo="body" [filter]="true" filterBy="key" [showClear]="true"
                                       emptyMessage=" " (onChange)="changeSelService()" [options]="servicesList" dataKey="id" optionLabel="key" class="w-full"></p-select>                                                                                                             
                                </div>
             
                        </div>          
                     </p-fluid>    
                     <p-fluid>
                        <div class="flex flex-col md:flex-row gap-6 mt-6">
                       
                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="dataInsDa">{{"Data Inserimento" | translate}} {{"Da" | translate}}</label>
                                    <p-datepicker [firstDayOfWeek]="1" name="dataInsDa" [dateFormat]="localeDateFormat" appendTo="body" class="w-full"
                                    placeholder="{{'gg/mm/aaaa' | translate}}" [showIcon]="true" [showButtonBar]="true" formControlName="dateFrom"></p-datepicker>
                                </div>

                                <div class="flex flex-wrap gap-2 w-full">
                                    <label for="dataInsA">{{"Data Inserimento" | translate}} {{"A" | translate}}</label>
                                    <p-datepicker [firstDayOfWeek]="1" name="dataInsA" dateFormat="{{localeDateFormat}}" appendTo="body" class="w-full"
                                    placeholder="{{'gg/mm/aaaa' | translate}}" [showIcon]="true" [showButtonBar]="true" formControlName="dateTo"></p-datepicker>
                                </div>

                                <div class="flex flex-wrap gap-2 w-full">
                                    <!-- <p-checkbox formControlName="onlyBillableControl" inputId="chkBillable" /> -->                                    
                                    <div class="flex items-center mt-6">
                                        <input id="chkBillable" formControlName="onlyBillableControl" type="checkbox" value="" >
                                        <label for="chkBillable" class="ms-2 text-gray-900 dark:text-gray-300">{{'Solo fatturabili' | translate}}</label>
                                    </div>
                                </div>                                

                                <div class="flex flex-wrap gap-2 w-full">

                                </div>
                                                          
                        </div>        
                   </p-fluid>

                    <hr>
                    <p-fluid>
                        <div class="flex flex-col gap-6 w-full mt-6">
                            <div class="flex flex-col md:flex-row gap-6">                            
                                <div class="flex flex-wrap gap-2 w-full">
                                    <p-button label="{{'Esegui' | translate}}" [loading]="isLoading" severity="primary" raised (click)="eseguiClicked()" />
                                    <p-button label="{{'Reimposta' | translate}}" [disabled]="isLoading" severity="secondary" raised (click)="resetFilters()"/>                                                                                               
                                </div>                                
                            </div>
                        </div>                    
                    </p-fluid>   
                </div>                                                  
            </p-accordion-content>            
        </p-accordion-panel>            
    </p-accordion>
</div>
@if (consumptionData) {
    <div class="card">
        <p-tabs value="0">
            <p-tablist>           
                <p-tab value="0"><i class="pi pi-chart-line"></i> {{'Metriche' | translate}}</p-tab> 
            </p-tablist>
            <p-tabpanels>
                <p-tabpanel value="0">
                    <div class="mt-2">
                        <p-panel header="{{'Totali' | translate}}" [toggleable]="true">
                            <div class="grid grid-cols-4 gap-4">
                                @for (item of consumptionData.metricsDetails.totalIndicatorItems; track $index) {
                                    <app-consumptions-counter class="d-none" [title]="item.title" [value]="item.value" [icon]="item.iconNew" [iconTitle]="item.iconTitle"></app-consumptions-counter>
                                } 
                            </div>
                            <app-consumptions-counters-table class="w-full d-md-none" [items]="consumptionData.metricsDetails.consumersDetails.totalIndicatorItems"></app-consumptions-counters-table>         
                        </p-panel>
                    </div>

                    <div class="mt-2">
                        <p-panel header="Consumer API" [toggleable]="true">
                            <div class="grid grid-cols-4 gap-4">
                               @for (item of consumptionData.metricsDetails.consumersDetails.totalIndicatorItems; track $index) {
                                    <app-consumptions-counter class="d-none" [title]="item.title" [value]="item.value" [icon]="item.iconNew" [iconTitle]="item.iconTitle"></app-consumptions-counter>
                                }
                            </div>
                            <app-consumptions-counters-table class="w-full d-md-none" [items]="consumptionData.metricsDetails.consumersDetails.totalIndicatorItems"></app-consumptions-counters-table>
                            <hr>
                            <app-consumptions-table [items]="consumptionData.metricsDetails.consumersDetails.consumptionsDetailRows"></app-consumptions-table>                    
                        </p-panel>
                    </div>

                    <div class="mt-2">
                        <p-panel header="{{'Aziende' | translate}}" [toggleable]="true">   
                            <div class="grid grid-cols-4 gap-4">
                               @for (item of consumptionData.metricsDetails.companiesDetails.totalIndicatorItems; track $index) {
                                <app-consumptions-counter class="d-none" [title]="item.title" [value]="item.value" [icon]="item.iconNew" [iconTitle]="item.iconTitle"></app-consumptions-counter>
                                }         
                            </div>
                            <app-consumptions-counters-table class="w-full d-md-none" [items]="consumptionData.metricsDetails.companiesDetails.totalIndicatorItems"></app-consumptions-counters-table>
                            <hr>
                            <app-consumptions-table [items]="consumptionData.metricsDetails.companiesDetails.consumptionsDetailRows"></app-consumptions-table>
                        </p-panel>
                    </div>

                    <div class="mt-2">
                        <p-panel header="{{'Andamento' | translate}}" [toggleable]="true">   
                            <p-fluid class="grid grid-cols-12 gap-8 ">

                                @for (item of consumptionData.metricsDetails.chartsItems; track $index) {
                                    <div class="col-span-12 xl:col-span-4">                                
                                        <div class="card" style="border:solid 1px silver!important;">
                                            <div class="font-bold mb-4">{{item.title}}</div>
                                                <p-chart [type]="item.lineChartType" [data]="item.chartData"  [options]="item.chartOptions" [plugins]="item.chartPlugins" class="w-full h-auto" />
                                        </div>
                                    </div>        
                                }                                                        
                            </p-fluid>
   
                        </p-panel>                        
                    </div>

                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>          
    </div>

    <p-scrolltop [threshold]="100" icon="pi pi-arrow-up" [buttonProps]="{ severity: 'contrast', raised: true, rounded: true }" />                           

    
}